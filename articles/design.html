<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Design • vizid</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Design">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vizid</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/design.html">Design</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Design</h1>
            
      

      <div class="hidden name"><code>design.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">vizid</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="purpose">Purpose<a class="anchor" aria-label="anchor" href="#purpose"></a>
</h2>
<p>The <code>vizid</code> package makes it easy to visualize infectious
disease data in <code>R</code>. It provides functionality for
transforming data frames so that they know how to visualize
themselves.</p>
</div>
<div class="section level2">
<h2 id="data-frames-are-primary-objects">Data Frames are Primary Objects<a class="anchor" aria-label="anchor" href="#data-frames-are-primary-objects"></a>
</h2>
<p>Many functions in this package are <strong>transformers</strong>:
they take a data frame and return a modified data frame. The data frame
acts as the single source of truth for both your <strong>data</strong>
and the <strong>state</strong> of your visualization session.</p>
<p>In this context, <em>state</em> refers to information stored in
attributes—such as:</p>
<ul>
<li>which variables should be used for which roles in the visualization
(e.g., the <code>cases</code> variable should be the
<code>series_variable</code> used in a time-series plot).</li>
<li>
<code>ggplot2</code> components that will be combined to produce a
plot object.</li>
<li>other metadata captured during previous steps that influences
default plotting behaviour.</li>
</ul>
<p>Because transformers carry this state forward, you use them in a
pipeline that ultimately produces a data frame ready for plotting.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>vizid_object <span class="ot">&lt;-</span> (data</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  <span class="co"># transformers from other packages that you love</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  <span class="sc">|&gt;</span> <span class="fu">non_vizid_functions</span>()</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  <span class="sc">|&gt;</span> ...</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  </span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  <span class="co"># transformers that modify data *and* carry forward state</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>  <span class="sc">|&gt;</span> <span class="fu">vizid_functions</span>()     </span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>  <span class="sc">|&gt;</span> ...</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>)</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="fu">data_frame_exploration_function</span>(vizid_object)</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="fu">plot</span>(vizid_object)</span></code></pre></div>
<p>One consequence of this design is that you can inspect the
<strong>data that will be plotted</strong> using all the standard R
tools for examining data frames (<code><a href="https://rdrr.io/r/utils/head.html" class="external-link">head()</a></code>,
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>, dplyr verbs, etc.). This is intentional: the
visible content of the data frame always reflects the data that
<code>vizid</code> will plot. Other aspects of the session state—such as
inferred variable roles, user-supplied choices, and metadata collected
along the way—are stored in <strong>attributes</strong>, which ordinary
data-frame tools ignore but which you can view with
<code><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes()</a></code> if needed.</p>
<p>If you want to insert your own transformation into a
<code>vizid</code> pipeline, you can write a custom transformer and wrap
it using the helper provided by <code>vizid</code>, ensuring that your
function returns a modified data frame <strong>and</strong> preserves
all relevant <code>vizid</code> attributes.</p>
<p>The final step in a <code>vizid</code> pipeline is another data
frame—one that includes the information required to produce a plot. This
aligns with base R behaviour: <code>plot(data)</code> works for any data
frame. <code>vizid</code> simply ensures that, for historical
infectious-disease data, the resulting plot is informative and
context-aware while still respecting the explicit choices you make
(e.g., selecting the correct series when multiple candidates exist).</p>
</div>
<div class="section level2">
<h2 id="variable-mappings">Variable Mappings<a class="anchor" aria-label="anchor" href="#variable-mappings"></a>
</h2>
</div>
<div class="section level2">
<h2 id="data-preparation-steps">Data Preparation Steps<a class="anchor" aria-label="anchor" href="#data-preparation-steps"></a>
</h2>
</div>
<div class="section level2">
<h2 id="plot-components">Plot Components<a class="anchor" aria-label="anchor" href="#plot-components"></a>
</h2>
</div>
<div class="section level2">
<h2 id="data-prep-functions">Data Prep Functions<a class="anchor" aria-label="anchor" href="#data-prep-functions"></a>
</h2>
<p>These functions do too many things, but that might be OK if we define
what these things are and stick to it at an abstract level.</p>
<ul>
<li>They set the roles associated with particular variables as
attributes</li>
<li>They transform the data in the standard ‘data-prep’ way</li>
<li>They merge variable roles and derived objects of the inputs with
those of the outputs (does merging involve validity as well? is this
mixing purposes?)</li>
<li>They set derived objects, that may be needed by downstream
functions, as attributes</li>
</ul>
<p>Some of these data-in / data-out functions have an important first
step: initializing the <code>vizid</code> attributes of the data. The
first step of this first step is to clear the existing attributes. If
you try to call a data-in / data-out function without this first step,
on a dataset without such a set of attributes, you will get an error.
This error will tell you about the set of functions that you can use to
start off a visualization process.</p>
</div>
<div class="section level2">
<h2 id="attribute-data-structure">Attribute Data Structure<a class="anchor" aria-label="anchor" href="#attribute-data-structure"></a>
</h2>
<ul>
<li>
<code>class</code> : S3 extension of the original <code>data</code>
object indicating the type of plot that is being produced. This
type</li>
<li>
<code>variable_roles</code> : TODO – define type
<ul><li>
</li></ul>
</li>
<li>
<code>messages</code> : methods to be called downstream, typically
containing derived quantities in their environment
<ul>
<li>I don’t want to actually have these</li>
<li>But we need them to pass messages</li>
<li>However, keep in mind that we only need to pass messages if we need
to compute something on the current state of the data, and then use it
later downstream after the data have changed – so it is a last
resort</li>
<li>This is information leakage caused by temporal decomposition, and so
maybe I should keep longer classes</li>
</ul>
</li>
<li>
<code>plot_components</code> : list of lists of lists
<ul>
<li>Each item in the outer list is associated with a single plot object,
which might be the result of several plots being combined using. <a href="https://patchwork.data-imaginist.com/" class="external-link">patchwork</a>.</li>
<li>Each item in the middle lists is associated with a collection of
plots that could be combined into a single plot using <a href="https://patchwork.data-imaginist.com/" class="external-link">patchwork</a>, or are a
collection of one plot already and therefore do not need combining.</li>
<li>Each item in the inner lists is associated with a <a href="https://ggplot2.tidyverse.org/" class="external-link">ggplot2</a> component (e.g., <a href="https://ggplot2.tidyverse.org/reference/#geoms" class="external-link">a geom</a>, <a href="https://ggplot2.tidyverse.org/reference/#facetting" class="external-link">a facetting
scheme</a>), which can be added together to produce a single plot
object.</li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="derived-datasets">Derived Datasets<a class="anchor" aria-label="anchor" href="#derived-datasets"></a>
</h2>
<p>Sometimes you need to produce two versions of your data. For example,
in a plot that combines two plots: one that visualizes the original data
and one that visualizes an aggregated version of these data. In this
case, the aggregated version should be sent down a path of producing its
own visualization and then the resulting plot object should be placed in
the <code>plot_components</code> of the attributes of the original
dataset.</p>
</div>
<div class="section level2">
<h2 id="functions-for-querying-data">Functions for Querying Data<a class="anchor" aria-label="anchor" href="#functions-for-querying-data"></a>
</h2>
<p>An example might be a function that guesses about the title of the
plot by looking into the name of values of the variable on the
y-axis.</p>
</div>
<div class="section level2">
<h2 id="functions-of-data-returning-plot-components">Functions of Data Returning Plot Components<a class="anchor" aria-label="anchor" href="#functions-of-data-returning-plot-components"></a>
</h2>
<p>These are special versions of functions that query data, in that the
results of the queries are objects that go in the
<code>plot_components</code> element of the attributes (e.g., output of
something <code>geom_line</code> or <code>facet_wrap</code> or
<code>aes</code>).</p>
</div>
<div class="section level2">
<h2 id="arguments-that-accept-either-querying-functions-or-for-convenience-values-that-could-be-returned-by-querying-functions">Arguments that Accept Either Querying Functions or (for convenience)
Values that Could be Returned by Querying Functions<a class="anchor" aria-label="anchor" href="#arguments-that-accept-either-querying-functions-or-for-convenience-values-that-could-be-returned-by-querying-functions"></a>
</h2>
</div>
<div class="section level2">
<h2 id="functions-that-set-variable-roles">Functions that Set Variable Roles<a class="anchor" aria-label="anchor" href="#functions-that-set-variable-roles"></a>
</h2>
</div>
<div class="section level2">
<h2 id="functions-that-guess-variable-roles">Functions that Guess Variable Roles<a class="anchor" aria-label="anchor" href="#functions-that-guess-variable-roles"></a>
</h2>
</div>
<div class="section level2">
<h2 id="types-of-arguments-and-return-values">Types of Arguments and Return Values<a class="anchor" aria-label="anchor" href="#types-of-arguments-and-return-values"></a>
</h2>
<ul>
<li>
<code>data</code> : Data frames – with attributes</li>
<li>
<code>variable_roles</code> : a mapping that associates each type of
variable categorized by its role in visualization (e.g.,
<code>series_variable</code>) to a type of variable categorized by its
role in epidemiology (e.g., <code>cases_this_period</code>)</li>
</ul>
</div>
<div class="section level2">
<h2 id="function-signatures">Function Signatures<a class="anchor" aria-label="anchor" href="#function-signatures"></a>
</h2>
<p>Many (all?) of the above types of functions differ only in their
return type, and not in their argument signature.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a_function</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">variable_roles</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span></span></code></pre></div>
<p>There is often a need for more inputs than these two arguments. For
example, we want to pass additional arguments to functions being wrapped
(e.g., <code>scale_y_continuous</code>). Another example might involve
passing in a colour scheme to use, or a summarizing statistic. The
possibilities are endless. The way we handle this is through
constructors.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a_constructor</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">args_scale_y_continuous</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">variable_roles</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We can create alternative constructors where we build up the
arguments to pass on using custom logic.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>custom_constructor <span class="ot">=</span> <span class="cf">function</span>()</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="naming-convensions">Naming Convensions<a class="anchor" aria-label="anchor" href="#naming-convensions"></a>
</h2>
</div>
<div class="section level2">
<h2 id="notes">Notes<a class="anchor" aria-label="anchor" href="#notes"></a>
</h2>
<ul>
<li>Spread them out in proportion to the time-series</li>
<li>Spread them out uniformly</li>
<li>Allow non-integer</li>
<li>Identifying the heap weeks</li>
<li>Look for outliers</li>
<li>Not everything in the heap weeks are heaped values – need to make a
decision about this</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Steve walker.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
